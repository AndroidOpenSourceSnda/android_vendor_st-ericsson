#!/bin/bash
#set -e

if [ -z $1 ]; then
	echo "Error $0: Missing argument 1"
	echo "          Expecting full or relative path to the file including
	echo "          the filename to the file that should be generated by
	echo "          this script."
	exit
fi

# Always remove the previously created file.
rm -f $1

if [ -z ${PLATFORM_NAME} ]; then
	echo "Error $0: Missing PLATFORM_NAME environment variable!"
	echo "          Expecting something like PLATFORM_NAME=8500"
	exit
fi

file=$1

touch $file

echo "/***************************************************************" >> $file
echo " * Copyright ST-Ericsson 2011" >> $file
echo " *" >> $file
echo " * Autogenerated file" >> $file
echo " *" >> $file
echo " * DO NOT EDIT THIS FILE!" >> $file
echo " **************************************************************/" >> $file
echo "#include \"cops_ta.h\"" >> $file


NUMBER_OF_TAS=$(ls ta/*cops_ta*${PLATFORM_NAME}*.ssw | wc -l)

echo "const uint8_t number_of_tas = ${NUMBER_OF_TAS};" >> $file

SSW_FILES=$(find . -name "*cops_ta*${PLATFORM_NAME}*.ssw")

COUNT=0
for name in $SSW_FILES
do
    echo "const uint8_t data${COUNT}[] = {" >> $file
    FILENAME=$(basename $name)
    tools/hexdump.pl ta/$FILENAME >> $file
    echo "};" >> $file
    COUNT=$(($COUNT+1))
done

echo "const uint8_t *cops_ta_list[] = {" >> $file
COUNT=0
for name in $SSW_FILES
do
    echo "    data"${COUNT}, >> $file
    COUNT=$(($COUNT+1))
done
echo "};" >> $file

echo "const uint32_t cops_ta_size_list[] = {" >> $file
for name in $SSW_FILES
do
    FILESIZE=$(stat -c%s $name)
    echo "    "${FILESIZE}"," >> $file
done
echo "};" >> $file


